<%= content_for(:mapapi) do %>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=D6ced4fa35c14b09189fba6b898c905f"></script>
<% end %>
<script type="text/javascript">
  $(document).ready(function() {
    var map = new BMap.Map("map_container");  
    map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);  
    // 创建地址解析器实例 
    var myGeo = new BMap.Geocoder();  
    var myIcon = new BMap.Icon("/bear.jpg", new BMap.Size(20,20));
    // 将地址解析结果显示在地图上，并调整地图视野
    myGeo.getPoint("<%= location %>", function(point){  
     if (point) {  
      map.centerAndZoom(point, 16);  
      var marker = new BMap.Marker(point,{icon:myIcon});
      //var marker = new BMap.Marker(point)
      map.addOverlay(marker);
      marker.setAnimation(BMAP_ANIMATION_BOUNCE);  
      marker.addEventListener("click", function(){this.openInfoWindow(infoWindow2);});
      //marker.addEventListener("mouseout", function(){this.closeInfoWindow(infoWindow2);});

     }  
    }, "<%= city %>");  
    var infoWindow2 = new BMap.InfoWindow("<p style='font-size:14px;'><%= location %></p>");
    map.enableScrollWheelZoom(true);
    function myFun(result){
      var cityName = result.name;
      return cityName;
    }
    var myCity = new BMap.LocalCity();
    myCity.get(myFun);
  });
</script>