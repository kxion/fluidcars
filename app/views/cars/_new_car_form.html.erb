<%= simple_form_for @car, :html => {:multipart => true} do |f| %>
  <div class="fieldset">
    <legend>车辆信息</legend>
    <%= f.input :brand, label: '型号', hint: '车辆品牌及型号', :placeholder=>"车辆型号" %>
    <%= f.input :description, as: :text, input_html: {rows: 5}, label: '描述', :placeholder=>"描述", hint: '请简单描述车况，更利于出租' %>
    <%= f.simple_fields_for :location do |loc| %>
      <div class="form-group">
        <%= loc.label '地区' %>
        <div class="col-lg-8">
          <%= loc.select :province, collection: [], value: 'yes' %>
          <%= loc.select :city, collection: [], value: 'ok' %>
          <%= loc.select :district, collection: [] %>
        </div>
      </div>
      <%= loc.input :detail, label: '详细地址', :placeholder=>"详细地址" %>
    <% end %>
    <div class="form-group">
      <label class="control-label col-lg-2">上传图片</label>
      <div class="col-md-8">
        <div><input type='file' id="upload_file" multiple=true></input></div>
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-4">
        <%= f.submit "保存", class: 'btn btn-primary btn-large' %>
      </div>
    </div>
  </div>
  <div class="add-upload"></div>
<% end %>
<%= render 'car_pictures/thumbnails' %> 

<script type="text/javascript">
  window.onload = function(){
    siteSelect(["car_location_attributes_province","car_location_attributes_city","car_location_attributes_district"],["","",""]);
    document.getElementById('upload_file').addEventListener("change", attachFiles, false);
    function attachFiles() {
      var files = this.files; /* now you can work with the file list */
      console.log(files.length);
      for (var index = 0, numFiles = files.length; index < numFiles; index++) {
        id = "upload_car_pictures"+index;
        $("div.add-upload").append("<input type='file' multiple = true name='car[car_pictures_attributes]["+index+"][picture]' id='"+id+"'></input>");
        $("#"+id).get(0).files = files;
        console.log($("#"+id).get(0).files[0]);
      };
    }
  }
</script>
<style>
  select {
    width:80px;
  }
</style>


